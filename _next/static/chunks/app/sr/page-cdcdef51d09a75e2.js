(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[194],{3565:function(e,a,r){Promise.resolve().then(r.bind(r,9396))},9396:function(e,a,r){"use strict";r.r(a),r.d(a,{PageContent:function(){return ef}});var t=r(5008),s=r(5966),n=r(6054),l=r(8108),c=r.n(l),i=r(6093);function d(){let e=async()=>{let e=JSON.stringify(await (0,i.D$)("sr"),null,2),a=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(a),t=document.createElement("a");t.href=r,t.download="".concat("sr","-exported-data-").concat(c()().format(i.c2),".json"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(r)};return(0,t.jsx)(n.z,{variant:"outline",onClick:()=>e(),children:"备份数据"})}var o=r(8229),u=r(426),h=r(3049),m=r(2262);let p=m.I0,x=m.v9;var v=r(342),g=r(8908),f=r(4459),j=r(2039),w=r.n(j),y=r(256);let N={key:"".concat(y.F.Account,"-default"),name:"default",displayName:"默认账户"};async function b(){let e="".concat(f.F.Account),a=await (0,i.ax)(e);return 0==a.length&&(await w().setItem(N.key,N),a.push(N.key)),(0,i.sF)(a)}var M=r(4989);let C=(0,g.hg)("".concat(M.f,"/accounts/fetchAccounts"),async(e,a)=>{let{rejectWithValue:r}=a;try{return b()}catch(e){return r({errorMessage:e.errorMessage||v.c})}}),k=e=>{e.addCase(C.pending,e=>{e.loading="pending",e.errorMessage=null}),e.addCase(C.fulfilled,(e,a)=>({loading:"succeeded",values:(0,i.FB)(a.payload),errorMessage:null,isLoaded:!0})),e.addCase(C.rejected,(e,a)=>{e.loading="failed",a.payload?e.errorMessage=a.payload.errorMessage:e.errorMessage=a.error.message||v.c})};function O(){let e=(0,h.j)(O),{toast:a}=(0,o.pm)(),r=p(),s=async t=>{var s;let n=null===(s=t.target.files)||void 0===s?void 0:s[0];if(n){let t=new FileReader;t.onload=async t=>{let s=t.target.result;try{let e=JSON.parse(s);await (0,u.s)(e,"sr"),r(C()),a({description:"操作成功"})}catch(a){e.error("Error parsing JSON:",a)}},t.readAsText(n)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.z,{variant:"outline",onClick:()=>{var e;null===(e=document.getElementById("recover-button-upload"))||void 0===e||e.click()},children:"恢复数据"}),(0,t.jsx)("input",{id:"recover-button-upload",type:"file",accept:".json",onChange:s,className:"hidden"})]})}var L=r(8943),S=r(8766),E=r(8769);let F=(0,E.P1)([e=>e.values,(e,a)=>a],(e,a)=>a&&e[a]||null),P=(0,E.P1)([e=>e.values,(e,a)=>a],(e,a)=>a&&(0,i.JJ)(e).find(e=>e.name===a)||null),A={ownership:!1,level:null};var I=r(8132);function R(e,a){return"".concat(f.F.Ownership,"-").concat(e,"-").concat(a)}async function U(e,a){let r=R(e,a);return await w().getItem(r)||A}async function B(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A,t=R(e,a);await w().setItem(t,r)}async function V(e,a,r){let t=await U(e,a),s=(0,I.Uy)(t,e=>{e.ownership=r});await B(e,a,s)}let _=(0,g.hg)("".concat("sr","/ownership/fetchOwnership"),async(e,a)=>{let{getState:r,rejectWithValue:t}=a;try{let e={},a=r(),t=a.accounts.values,s=a.characters.values;if(!a.accounts.isLoaded||!a.characters.isLoaded)return null;for(let a in t)for(let r in s)e[a]={[r]:await U(a,r)};return e}catch(e){return t({errorMessage:e.errorMessage||v.c})}}),J=e=>{e.addCase(_.pending,e=>{e.loading="pending",e.errorMessage=null}),e.addCase(_.fulfilled,(e,a)=>{if(a.payload)return{loading:"succeeded",values:a.payload,errorMessage:null,isLoaded:!0}}),e.addCase(_.rejected,(e,a)=>{e.loading="failed",a.payload?e.errorMessage=a.payload.errorMessage:e.errorMessage=a.error.message||v.c})},Q=(0,g.hg)("".concat("sr","/ownership/saveOwnershipValue"),async(e,a)=>{let{characterName:r,accountKey:t,newValue:s}=e,{rejectWithValue:n}=a;try{if(!r||!t)return;await V(r,t,s)}catch(e){return n({errorMessage:e.errorMessage||v.c})}});var z=r(7935),D=r.n(z);let T=(0,g.oM)({name:"".concat("sr","/ownership"),initialState:D()({values:{},isLoaded:!1,loading:"idle",errorMessage:null}),reducers:{setOwnershipValue(e,a){let{payload:{accountKey:r,characterName:t,newValue:s}}=a;void 0!==s&&r&&t&&(void 0===e.values[r]&&(e.values[r]={}),void 0===e.values[r][t]&&(e.values[r][t]=D()(A)),e.values[r][t].ownership=s)}},selectors:{selectOwnershipValue:(0,E.P1)([e=>e.values,(e,a)=>a,(e,a,r)=>r],(e,a,r)=>{var t;return a?((null===(t=e[a])||void 0===t?void 0:t[r])||D()(A)).ownership:A.ownership}),selectOwnCharacterNames:(0,E.P1)([e=>e.values,(e,a)=>a,(e,a,r)=>r],(e,a,r)=>{if(!a)return[];let t=[];for(let l in r){var s,n;(null===(n=e[a])||void 0===n?void 0:null===(s=n[l])||void 0===s?void 0:s.ownership)===!0&&t.push(l)}return t})},extraReducers:e=>{J(e)}}),{setOwnershipValue:K}=T.actions,{selectOwnershipValue:$,selectOwnCharacterNames:q}=T.getSelectors(),G=T.reducer;function H(e){let{accountName:a="default",character:r,showImage:s=!1}=e,{ownershipFilter:n}=x(e=>e.view),l=x(e=>P(e.accounts,a)),c=(null==l?void 0:l.key)||null,d=r.name,o=x(e=>$(e.ownership,c,d)),u=p(),h=()=>{u(K({accountKey:c,characterName:d,newValue:!o}))},m=(0,L.useMemo)(()=>("true"!==n||!1!==o)&&("false"!==n||!0!==o),[n,o]);return s?(0,t.jsxs)("div",{className:(0,i.cn)("flex flex-col gap-1 hover:cursor-pointer border-2 border-white hover:border-gray-200 p-1 rounded",o&&"text-green-600",!m&&"hidden"),onClick:h,children:[(0,t.jsx)(S.default,{width:256,height:349,src:r.detail?r.detail.avatar:r.image,alt:r.name,className:"rounded-md object-cover w-[100px]",priority:!0}),(0,t.jsx)("span",{className:"text-sm",children:r.name})]}):(0,t.jsx)("span",{className:(0,i.cn)("hover:bg-gray-100 hover:cursor-pointer px-2 rounded",o&&"text-green-600",!m&&"hidden"),onClick:h,children:r.name})}function W(e){let{showImage:a=!1}=e,r=x(e=>e.characters.values),s=(0,L.useMemo)(()=>Object.values(r),[r]);return(0,t.jsx)("div",{className:"flex flex-wrap gap-4 mt-5",children:null==s?void 0:s.map(e=>(0,t.jsx)(H,{character:e,showImage:a},"character-".concat(e.name)))})}let X=(0,g.oM)({name:"".concat("sr","/characters"),initialState:D()({values:{},isLoaded:!1}),reducers:{setCharacters:(e,a)=>{let{payload:r}=a;return{values:Object.fromEntries(r.map(e=>[e.name,e])),isLoaded:!0}}},selectors:{selectCharacter:(0,E.P1)([e=>e.isLoaded,e=>e.values,(e,a)=>a],(e,a,r)=>e?a[r]:null)}}),{setCharacters:Y}=X.actions,{selectCharacter:Z}=X.getSelectors(),ee=X.reducer,ea=(0,g.oM)({name:"".concat(M.f,"/accounts"),initialState:D()({values:{},loading:"idle",errorMessage:null,isLoaded:!1}),reducers:{setAccounts:(e,a)=>{let{payload:r}=a;(0,i.FB)(r)},setDisplayName:(e,a)=>{let{payload:r}=a,{key:t,displayName:s}=r;if(!t)return e;t in e.values?e.values[t].displayName=s:(e.loading="failed",e.errorMessage="redux 没有未找到 key 为 ".concat(t," 的 Account 对象"))}},selectors:{selectAccountByKey:F,selectAccountByName:P},extraReducers:e=>{k(e)}}),{setAccounts:er,setDisplayName:et}=ea.actions,es=ea.reducer,en=(0,g.oM)({name:"".concat("sr","/ownership"),initialState:D()({ownershipFilter:"both"}),reducers:{setOwnershipFilter:(e,a)=>{let{payload:r}=a;e.ownershipFilter=r}}}),{setOwnershipFilter:el}=en.actions,ec=en.reducer,ei=(0,g.e)(),ed=()=>(0,g.xC)({reducer:{characters:ee,ownership:G,accounts:es,view:ec},middleware:e=>e().prepend(ei.middleware)});E.P1.withTypes();let eo=ei.startListening;function eu(e){let{children:a,characters:r}=e,s=(0,L.useRef)();return s.current||(s.current=ed(),s.current.dispatch(C()),s.current.dispatch(Y(r))),(0,L.useEffect)(()=>{let e=[function(e){let a=[e({actionCreator:er,effect:async(e,a)=>{a.dispatch(_())}})];return()=>{a.forEach(e=>e())}}(eo),function(e){let a=[e({actionCreator:K,effect:async(e,a)=>{let{payload:r}=e;a.dispatch(Q(r))}})];return()=>{a.forEach(e=>e())}}(eo),function(e){let a=[e({actionCreator:Y,effect:async(e,a)=>{a.dispatch(_())}})];return()=>{a.forEach(e=>e())}}(eo)];return()=>e.forEach(e=>e())},[]),(0,t.jsx)(m.zt,{store:s.current,children:a})}var eh=r(9733);let em=()=>{let{ownershipFilter:e}=x(e=>e.view),a=p();return(0,t.jsxs)(eh.Ph,{value:e,onValueChange:e=>a(el(e)),children:[(0,t.jsx)(eh.i4,{className:"w-[180px]",children:(0,t.jsx)(eh.ki,{placeholder:"所有权"})}),(0,t.jsxs)(eh.Bw,{children:[(0,t.jsx)(eh.Ql,{value:"both",children:"所有权（全部）"}),(0,t.jsx)(eh.Ql,{value:"true",children:"所有权（拥有）"}),(0,t.jsx)(eh.Ql,{value:"false",children:"所有权（未拥有）"})]})]})};var ep=r(3646),ex=r.n(ep);function ev(e){let{relicsets:a}=e,r=x(e=>e.characters.values),s=(0,L.useMemo)(()=>Object.values(r),[r]);return ex()(a)?(0,t.jsxs)("table",{className:"mt-5 table-auto",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"leading-loose",children:[(0,t.jsx)("th",{children:"遗器"}),(0,t.jsx)("th",{children:"角色"}),(0,t.jsx)("th",{children:"躯干"}),(0,t.jsx)("th",{children:"脚部"}),(0,t.jsx)("th",{children:"位面球"}),(0,t.jsx)("th",{children:"连结绳"}),(0,t.jsx)("th",{children:"副词条"})]})}),(0,t.jsx)("tbody",{children:a.map((e,a)=>{let r=s.filter(a=>a.detail.recommend.隧洞遗器.includes(e.name)||a.detail.recommend.位面饰品.includes(e.name));return 0===r.length?(0,t.jsxs)("tr",{className:(0,i.cn)("text-xs",a%2==0&&"bg-slate-100"),children:[(0,t.jsxs)("td",{rowSpan:r.length||void 0,className:"p-4 space-y-2 text-center",children:[(0,t.jsx)(S.default,{width:256,height:349,src:e.image,alt:e.name,className:"rounded-md object-cover w-[100px] mx-auto",priority:!0}),(0,t.jsx)("p",{className:"font-bold",children:e.name})]}),(0,t.jsx)("td",{className:"p-4",children:"-"}),(0,t.jsx)("td",{className:"p-4",children:"-"}),(0,t.jsx)("td",{className:"p-4",children:"-"}),(0,t.jsx)("td",{className:"p-4",children:"-"}),(0,t.jsx)("td",{className:"p-4",children:"-"}),(0,t.jsx)("td",{className:"p-4",children:"-"})]},"reliceset-".concat(a)):r.map((s,n)=>{let l=s.detail.recommend.位面饰品.includes(e.name);return(0,t.jsxs)("tr",{className:(0,i.cn)("text-xs",a%2==0&&"bg-slate-100"),children:[0===n&&(0,t.jsxs)("td",{rowSpan:r.length||void 0,className:"p-4 space-y-2 text-center",children:[(0,t.jsx)(S.default,{width:256,height:349,src:e.image,alt:e.name,className:"rounded-md object-cover w-[100px] mx-auto",priority:!0}),(0,t.jsx)("p",{className:"font-bold",children:e.name})]}),(0,t.jsx)("td",{className:"p-4",children:s.name}),(0,t.jsx)("td",{className:"p-4",children:l?"-":eg(s.detail.recommend.主词条推荐.躯干)}),(0,t.jsx)("td",{className:"p-4",children:l?"-":eg(s.detail.recommend.主词条推荐.脚部)}),(0,t.jsx)("td",{className:"p-4",children:l?eg(s.detail.recommend.主词条推荐.位面球):"-"}),(0,t.jsx)("td",{className:"p-4",children:l?eg(s.detail.recommend.主词条推荐.连结绳):"-"}),(0,t.jsx)("td",{className:"p-4",children:eg(s.detail.recommend.副词条推荐)})]},s.name)})})})]}):(0,t.jsx)(t.Fragment,{})}function eg(e){return(0,t.jsx)("div",{className:"flex flex-col",children:e.map((e,a)=>(0,t.jsx)("span",{children:e},"item-".concat(a)))})}function ef(e){let{characters:a=[],relicsets:r=[]}=e;return(0,t.jsx)(eu,{characters:a,children:(0,t.jsxs)("section",{className:"container grid items-center gap-6 pt-6 pb-8 md:py-10",children:[(0,t.jsx)("div",{className:"flex max-w-[980px] flex-col items-start gap-2",children:(0,t.jsx)("h1",{className:"text-3xl font-extrabold tracking-tighter leading-tight md:text-4xl",children:"崩坏：星穹铁道"})}),(0,t.jsxs)(s.mQ,{defaultValue:"image-text",children:[(0,t.jsxs)("nav",{className:"flex gap-4",children:[(0,t.jsxs)(s.dr,{children:[(0,t.jsx)(s.SP,{value:"text",children:"文字"}),(0,t.jsx)(s.SP,{value:"image-text",children:"图文"}),(0,t.jsx)(s.SP,{value:"relicsets",children:"遗器"})]}),(0,t.jsx)(em,{}),(0,t.jsx)(d,{}),(0,t.jsx)(O,{})]}),(0,t.jsx)(s.nU,{value:"text",children:(0,t.jsx)(W,{showImage:!1})}),(0,t.jsx)(s.nU,{value:"image-text",children:(0,t.jsx)(W,{showImage:!0})}),(0,t.jsx)(s.nU,{value:"relicsets",children:(0,t.jsx)(ev,{relicsets:r})})]})]})})}}},function(e){e.O(0,[415,680,398,522,561,67,744],function(){return e(e.s=3565)}),_N_E=e.O()}]);