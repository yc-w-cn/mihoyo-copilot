(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[194],{3649:function(e,r,a){Promise.resolve().then(a.bind(a,6160))},6160:function(e,r,a){"use strict";a.r(r),a.d(r,{PageContent:function(){return ev}});var t=a(4906),n=a(1914),s=a(9162),l=a(2543),c=a.n(l),o=a(8417);function i(){let e=async()=>{let e=JSON.stringify(await (0,o.D$)("sr"),null,2),r=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(r),t=document.createElement("a");t.href=a,t.download="".concat("sr","-exported-data-").concat(c()().format(o.c2),".json"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)};return(0,t.jsx)(s.z,{variant:"outline",onClick:()=>e(),children:"备份数据"})}var d=a(7372),u=a(9140),h=a(9672),p=a(916);let v=p.I0,f=p.v9;var g=a(6535),m=a(2307),x=a(4187),w=a(4389),y=a.n(w),j=a(7928);let M={key:"".concat(j.F.Account,"-default"),name:"default",displayName:"默认账户"};async function C(){let e="".concat(x.F.Account),r=await (0,o.ax)(e);return 0==r.length&&(await y().setItem(M.key,M),r.push(M.key)),(0,o.sF)(r)}var N=a(9779);let b=(0,m.hg)("".concat(N.f,"/accounts/fetchAccounts"),async(e,r)=>{let{rejectWithValue:a}=r;try{return C()}catch(e){return a({errorMessage:e.errorMessage||g.c})}}),k=e=>{e.addCase(b.pending,e=>{e.loading="pending",e.errorMessage=null}),e.addCase(b.fulfilled,(e,r)=>({loading:"succeeded",values:(0,o.FB)(r.payload),errorMessage:null,isLoaded:!0})),e.addCase(b.rejected,(e,r)=>{e.loading="failed",r.payload?e.errorMessage=r.payload.errorMessage:e.errorMessage=r.error.message||g.c})};function O(){let e=(0,h.j)(O),{toast:r}=(0,d.pm)(),a=v(),n=async t=>{var n;let s=null===(n=t.target.files)||void 0===n?void 0:n[0];if(s){let t=new FileReader;t.onload=async t=>{let n=t.target.result;try{let e=JSON.parse(n);await (0,u.s)(e,"sr"),a(b()),r({description:"操作成功"})}catch(r){e.error("Error parsing JSON:",r)}},t.readAsText(s)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.z,{variant:"outline",onClick:()=>{var e;null===(e=document.getElementById("recover-button-upload"))||void 0===e||e.click()},children:"恢复数据"}),(0,t.jsx)("input",{id:"recover-button-upload",type:"file",accept:".json",onChange:n,className:"hidden"})]})}var L=a(5181),E=a(5072),F=a(4480);let P=(0,F.P1)([e=>e.values,(e,r)=>r],(e,r)=>r&&e[r]||null),S=(0,F.P1)([e=>e.values,(e,r)=>r],(e,r)=>r&&(0,o.JJ)(e).find(e=>e.name===r)||null),A={ownership:!1,level:null};var I=a(3177);function R(e,r){return"".concat(x.F.Ownership,"-").concat(e,"-").concat(r)}async function B(e,r){let a=R(e,r);return await y().getItem(a)||A}async function U(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A,t=R(e,r);await y().setItem(t,a)}async function V(e,r,a){let t=await B(e,r),n=(0,I.Uy)(t,e=>{e.ownership=a});await U(e,r,n)}let _=(0,m.hg)("".concat("sr","/ownership/fetchOwnership"),async(e,r)=>{let{getState:a,rejectWithValue:t}=r;try{let e={},r=a(),t=r.accounts.values,n=r.characters.values;if(!r.accounts.isLoaded||!r.characters.isLoaded)return null;for(let r in t)for(let a in n)e[r]={[a]:await B(r,a)};return e}catch(e){return t({errorMessage:e.errorMessage||g.c})}}),J=e=>{e.addCase(_.pending,e=>{e.loading="pending",e.errorMessage=null}),e.addCase(_.fulfilled,(e,r)=>{if(r.payload)return{loading:"succeeded",values:r.payload,errorMessage:null,isLoaded:!0}}),e.addCase(_.rejected,(e,r)=>{e.loading="failed",r.payload?e.errorMessage=r.payload.errorMessage:e.errorMessage=r.error.message||g.c})},Q=(0,m.hg)("".concat("sr","/ownership/saveOwnershipValue"),async(e,r)=>{let{characterName:a,accountKey:t,newValue:n}=e,{rejectWithValue:s}=r;try{if(!a||!t)return;await V(a,t,n)}catch(e){return s({errorMessage:e.errorMessage||g.c})}});var z=a(2492),D=a.n(z);let T=(0,m.oM)({name:"".concat("sr","/ownership"),initialState:D()({values:{},isLoaded:!1,loading:"idle",errorMessage:null}),reducers:{setOwnershipValue(e,r){let{payload:{accountKey:a,characterName:t,newValue:n}}=r;void 0!==n&&a&&t&&(void 0===e.values[a]&&(e.values[a]={}),void 0===e.values[a][t]&&(e.values[a][t]=D()(A)),e.values[a][t].ownership=n)}},selectors:{selectOwnershipValue:(0,F.P1)([e=>e.values,(e,r)=>r,(e,r,a)=>a],(e,r,a)=>{var t;return r?((null===(t=e[r])||void 0===t?void 0:t[a])||D()(A)).ownership:A.ownership}),selectOwnCharacterNames:(0,F.P1)([e=>e.values,(e,r)=>r,(e,r,a)=>a],(e,r,a)=>{if(!r)return[];let t=[];for(let l in a){var n,s;(null===(s=e[r])||void 0===s?void 0:null===(n=s[l])||void 0===n?void 0:n.ownership)===!0&&t.push(l)}return t})},extraReducers:e=>{J(e)}}),{setOwnershipValue:K}=T.actions,{selectOwnershipValue:$,selectOwnCharacterNames:q}=T.getSelectors(),G=T.reducer;function H(e){let{accountName:r="default",character:a,showImage:n=!1}=e,{ownershipFilter:s}=f(e=>e.view),l=f(e=>S(e.accounts,r)),c=(null==l?void 0:l.key)||null,i=a.name,d=f(e=>$(e.ownership,c,i)),u=v(),h=()=>{u(K({accountKey:c,characterName:i,newValue:!d}))},p=(0,L.useMemo)(()=>("true"!==s||!1!==d)&&("false"!==s||!0!==d),[s,d]);return n?(0,t.jsxs)("div",{className:(0,o.cn)("flex flex-col gap-1 hover:cursor-pointer border-2 border-white hover:border-gray-200 p-1 rounded",d&&"text-green-600",!p&&"hidden"),onClick:h,children:[(0,t.jsx)(E.default,{width:256,height:349,src:a.image,alt:a.name,className:"rounded-md object-cover w-[100px]",priority:!0}),(0,t.jsx)("span",{className:"text-sm",children:a.name})]}):(0,t.jsx)("span",{className:(0,o.cn)("hover:bg-gray-100 hover:cursor-pointer px-2 rounded",d&&"text-green-600",!p&&"hidden"),onClick:h,children:a.name})}function W(e){let{showImage:r=!1}=e,a=f(e=>e.characters.values),n=(0,L.useMemo)(()=>Object.values(a),[a]);return(0,t.jsx)("div",{className:"flex flex-wrap gap-4 mt-5",children:null==n?void 0:n.map(e=>(0,t.jsx)(H,{character:e,showImage:r},"character-".concat(e.name)))})}let X=(0,m.oM)({name:"".concat("sr","/characters"),initialState:D()({values:{},isLoaded:!1}),reducers:{setCharacters:(e,r)=>{let{payload:a}=r;return{values:Object.fromEntries(a.map(e=>[e.name,e])),isLoaded:!0}}},selectors:{selectCharacter:(0,F.P1)([e=>e.isLoaded,e=>e.values,(e,r)=>r],(e,r,a)=>e?r[a]:null)}}),{setCharacters:Y}=X.actions,{selectCharacter:Z}=X.getSelectors(),ee=X.reducer,er=(0,m.oM)({name:"".concat(N.f,"/accounts"),initialState:D()({values:{},loading:"idle",errorMessage:null,isLoaded:!1}),reducers:{setAccounts:(e,r)=>{let{payload:a}=r;(0,o.FB)(a)},setDisplayName:(e,r)=>{let{payload:a}=r,{key:t,displayName:n}=a;if(!t)return e;t in e.values?e.values[t].displayName=n:(e.loading="failed",e.errorMessage="redux 没有未找到 key 为 ".concat(t," 的 Account 对象"))}},selectors:{selectAccountByKey:P,selectAccountByName:S},extraReducers:e=>{k(e)}}),{setAccounts:ea,setDisplayName:et}=er.actions,en=er.reducer,es=(0,m.oM)({name:"".concat("sr","/ownership"),initialState:D()({ownershipFilter:"both"}),reducers:{setOwnershipFilter:(e,r)=>{let{payload:a}=r;e.ownershipFilter=a}}}),{setOwnershipFilter:el}=es.actions,ec=es.reducer,eo=(0,m.e)(),ei=()=>(0,m.xC)({reducer:{characters:ee,ownership:G,accounts:en,view:ec},middleware:e=>e().prepend(eo.middleware)});F.P1.withTypes();let ed=eo.startListening;function eu(e){let{children:r,characters:a}=e,n=(0,L.useRef)();return n.current||(n.current=ei(),n.current.dispatch(b()),n.current.dispatch(Y(a))),(0,L.useEffect)(()=>{let e=[function(e){let r=[e({actionCreator:ea,effect:async(e,r)=>{r.dispatch(_())}})];return()=>{r.forEach(e=>e())}}(ed),function(e){let r=[e({actionCreator:K,effect:async(e,r)=>{let{payload:a}=e;r.dispatch(Q(a))}})];return()=>{r.forEach(e=>e())}}(ed),function(e){let r=[e({actionCreator:Y,effect:async(e,r)=>{r.dispatch(_())}})];return()=>{r.forEach(e=>e())}}(ed)];return()=>e.forEach(e=>e())},[]),(0,t.jsx)(p.zt,{store:n.current,children:r})}var eh=a(4587);let ep=()=>{let{ownershipFilter:e}=f(e=>e.view),r=v();return(0,t.jsxs)(eh.Ph,{value:e,onValueChange:e=>r(el(e)),children:[(0,t.jsx)(eh.i4,{className:"w-[180px]",children:(0,t.jsx)(eh.ki,{placeholder:"所有权"})}),(0,t.jsxs)(eh.Bw,{children:[(0,t.jsx)(eh.Ql,{value:"both",children:"所有权（全部）"}),(0,t.jsx)(eh.Ql,{value:"true",children:"所有权（拥有）"}),(0,t.jsx)(eh.Ql,{value:"false",children:"所有权（未拥有）"})]})]})};function ev(e){let{characters:r=[]}=e;return(0,t.jsx)(eu,{characters:r,children:(0,t.jsxs)("section",{className:"container grid items-center gap-6 pb-8 pt-6 md:py-10",children:[(0,t.jsx)("div",{className:"flex max-w-[980px] flex-col items-start gap-2",children:(0,t.jsx)("h1",{className:"text-3xl font-extrabold leading-tight tracking-tighter md:text-4xl",children:"原神"})}),(0,t.jsxs)(n.mQ,{defaultValue:"image-text",children:[(0,t.jsxs)("nav",{className:"flex gap-4",children:[(0,t.jsxs)(n.dr,{children:[(0,t.jsx)(n.SP,{value:"text",children:"文字"}),(0,t.jsx)(n.SP,{value:"image-text",children:"图文"})]}),(0,t.jsx)(ep,{}),(0,t.jsx)(i,{}),(0,t.jsx)(O,{})]}),(0,t.jsx)(n.nU,{value:"text",children:(0,t.jsx)(W,{showImage:!1})}),(0,t.jsx)(n.nU,{value:"image-text",children:(0,t.jsx)(W,{showImage:!0})})]})]})})}}},function(e){e.O(0,[415,609,321,610,943,966,744],function(){return e(e.s=3649)}),_N_E=e.O()}]);