(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[952],{51:function(e,a,r){Promise.resolve().then(r.bind(r,2566))},2566:function(e,a,r){"use strict";r.r(a),r.d(a,{PageContent:function(){return ef}});var t=r(4906),n=r(1914),s=r(9162),l=r(2543),c=r.n(l),o=r(8417),i=r(9779);function d(){let e=async()=>{let e=JSON.stringify(await (0,o.D$)(i.f),null,2),a=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(a),t=document.createElement("a");t.href=r,t.download="".concat(i.f,"-exported-data-").concat(c()().format(o.c2),".json"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(r)};return(0,t.jsx)(s.z,{variant:"outline",onClick:()=>e(),children:"备份数据"})}var u=r(7372),h=r(9140),p=r(9672),f=r(916);let v=f.I0,g=f.v9;var m=r(6535),x=r(2307),w=r(4187),y=r(4389),j=r.n(y),M=r(7928);let C={key:"".concat(M.F.Account,"-default"),name:"default",displayName:"默认账户"};async function N(){let e="".concat(w.F.Account),a=await (0,o.ax)(e);return 0==a.length&&(await j().setItem(C.key,C),a.push(C.key)),(0,o.sF)(a)}let b=(0,x.hg)("".concat(i.f,"/accounts/fetchAccounts"),async(e,a)=>{let{rejectWithValue:r}=a;try{return N()}catch(e){return r({errorMessage:e.errorMessage||m.c})}}),k=e=>{e.addCase(b.pending,e=>{e.loading="pending",e.errorMessage=null}),e.addCase(b.fulfilled,(e,a)=>({loading:"succeeded",values:(0,o.FB)(a.payload),errorMessage:null,isLoaded:!0})),e.addCase(b.rejected,(e,a)=>{e.loading="failed",a.payload?e.errorMessage=a.payload.errorMessage:e.errorMessage=a.error.message||m.c})};function O(){let e=(0,p.j)(O),{toast:a}=(0,u.pm)(),r=v(),n=async t=>{var n;let s=null===(n=t.target.files)||void 0===n?void 0:n[0];if(s){let t=new FileReader;t.onload=async t=>{let n=t.target.result;try{let e=JSON.parse(n);await (0,h.s)(e,i.f),r(b()),a({description:"操作成功"})}catch(a){e.error("Error parsing JSON:",a)}},t.readAsText(s)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.z,{variant:"outline",onClick:()=>{var e;null===(e=document.getElementById("recover-button-upload"))||void 0===e||e.click()},children:"恢复数据"}),(0,t.jsx)("input",{id:"recover-button-upload",type:"file",accept:".json",onChange:n,className:"hidden"})]})}var L=r(5181),E=r(5072),F=r(4480);let P=(0,F.P1)([e=>e.values,(e,a)=>a],(e,a)=>a&&e[a]||null),S=(0,F.P1)([e=>e.values,(e,a)=>a],(e,a)=>a&&(0,o.JJ)(e).find(e=>e.name===a)||null),A={ownership:!1,level:null};var I=r(3177);function R(e,a){return"".concat(w.F.Ownership,"-").concat(e,"-").concat(a)}async function B(e,a){let r=R(e,a);return await j().getItem(r)||A}async function U(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A,t=R(e,a);await j().setItem(t,r)}async function V(e,a,r){let t=await B(e,a),n=(0,I.Uy)(t,e=>{e.ownership=r});await U(e,a,n)}let _=(0,x.hg)("".concat(i.f,"/ownership/fetchOwnership"),async(e,a)=>{let{getState:r,rejectWithValue:t}=a;try{let e={},a=r(),t=a.accounts.values,n=a.characters.values;if(!a.accounts.isLoaded||!a.characters.isLoaded)return null;for(let a in t)for(let r in n)e[a]={[r]:await B(a,r)};return e}catch(e){return t({errorMessage:e.errorMessage||m.c})}}),J=e=>{e.addCase(_.pending,e=>{e.loading="pending",e.errorMessage=null}),e.addCase(_.fulfilled,(e,a)=>{if(a.payload)return{loading:"succeeded",values:a.payload,errorMessage:null,isLoaded:!0}}),e.addCase(_.rejected,(e,a)=>{e.loading="failed",a.payload?e.errorMessage=a.payload.errorMessage:e.errorMessage=a.error.message||m.c})},Q=(0,x.hg)("".concat(i.f,"/ownership/saveOwnershipValue"),async(e,a)=>{let{characterName:r,accountKey:t,newValue:n}=e,{rejectWithValue:s}=a;try{if(!r||!t)return;await V(r,t,n)}catch(e){return s({errorMessage:e.errorMessage||m.c})}});var z=r(2492),D=r.n(z);let T=(0,x.oM)({name:"".concat(i.f,"/ownership"),initialState:D()({values:{},isLoaded:!1,loading:"idle",errorMessage:null}),reducers:{setOwnershipValue(e,a){let{payload:{accountKey:r,characterName:t,newValue:n}}=a;void 0!==n&&r&&t&&(void 0===e.values[r]&&(e.values[r]={}),void 0===e.values[r][t]&&(e.values[r][t]=D()(A)),e.values[r][t].ownership=n)}},selectors:{selectOwnershipValue:(0,F.P1)([e=>e.values,(e,a)=>a,(e,a,r)=>r],(e,a,r)=>{var t;return a?((null===(t=e[a])||void 0===t?void 0:t[r])||D()(A)).ownership:A.ownership}),selectOwnCharacterNames:(0,F.P1)([e=>e.values,(e,a)=>a,(e,a,r)=>r],(e,a,r)=>{if(!a)return[];let t=[];for(let l in r){var n,s;(null===(s=e[a])||void 0===s?void 0:null===(n=s[l])||void 0===n?void 0:n.ownership)===!0&&t.push(l)}return t})},extraReducers:e=>{J(e)}}),{setOwnershipValue:K}=T.actions,{selectOwnershipValue:$,selectOwnCharacterNames:q}=T.getSelectors(),G=T.reducer;function H(e){let{accountName:a="default",character:r,showImage:n=!1}=e,{ownershipFilter:s}=g(e=>e.view),l=g(e=>S(e.accounts,a)),c=(null==l?void 0:l.key)||null,i=r.name,d=g(e=>$(e.ownership,c,i)),u=v(),h=()=>{u(K({accountKey:c,characterName:i,newValue:!d}))},p=(0,L.useMemo)(()=>("true"!==s||!1!==d)&&("false"!==s||!0!==d),[s,d]);return n?(0,t.jsxs)("div",{className:(0,o.cn)("flex flex-col gap-1 hover:cursor-pointer border-2 border-white hover:border-gray-200 p-1 rounded",d&&"text-green-600",!p&&"hidden"),onClick:h,children:[(0,t.jsx)(E.default,{width:100,height:86,src:r.image,alt:r.name,className:"rounded-md object-cover",priority:!0}),(0,t.jsx)("span",{className:"text-sm",children:r.name})]}):(0,t.jsx)("span",{className:(0,o.cn)("hover:bg-gray-100 hover:cursor-pointer px-2 rounded",d&&"text-green-600",!p&&"hidden"),onClick:h,children:r.name})}function W(e){let{showImage:a=!1}=e,r=g(e=>e.characters.values),n=(0,L.useMemo)(()=>Object.values(r),[r]);return(0,t.jsx)("div",{className:"flex flex-wrap gap-4 mt-5",children:null==n?void 0:n.map(e=>(0,t.jsx)(H,{character:e,showImage:a},"character-".concat(e.name)))})}let X=(0,x.oM)({name:"".concat(i.f,"/characters"),initialState:{},reducers:{setCharacters:(e,a)=>{let{payload:r}=a;return{values:Object.fromEntries(r.map(e=>[e.name,e])),isLoaded:!0}}},selectors:{selectCharacter:(0,F.P1)([e=>e.isLoaded,e=>e.values,(e,a)=>a],(e,a,r)=>e?a[r]:null)}}),{setCharacters:Y}=X.actions,{selectCharacter:Z}=X.getSelectors(),ee=X.reducer,ea=(0,x.oM)({name:"".concat(i.f,"/accounts"),initialState:D()({values:{},loading:"idle",errorMessage:null,isLoaded:!1}),reducers:{setAccounts:(e,a)=>{let{payload:r}=a;(0,o.FB)(r)},setDisplayName:(e,a)=>{let{payload:r}=a,{key:t,displayName:n}=r;if(!t)return e;t in e.values?e.values[t].displayName=n:(e.loading="failed",e.errorMessage="redux 没有未找到 key 为 ".concat(t," 的 Account 对象"))}},selectors:{selectAccountByKey:P,selectAccountByName:S},extraReducers:e=>{k(e)}}),{setAccounts:er,setDisplayName:et}=ea.actions,en=ea.reducer,es=(0,x.oM)({name:"".concat(i.f,"/ownership"),initialState:D()({ownershipFilter:"both"}),reducers:{setOwnershipFilter:(e,a)=>{let{payload:r}=a;e.ownershipFilter=r}}}),{setOwnershipFilter:el}=es.actions,ec=es.reducer,eo=(0,x.e)(),ei=()=>(0,x.xC)({reducer:{characters:ee,ownership:G,accounts:en,view:ec},middleware:e=>e().prepend(eo.middleware)});F.P1.withTypes();let ed=eo.startListening;function eu(e){let{children:a,characters:r}=e,n=(0,L.useRef)();return n.current||(n.current=ei(),n.current.dispatch(b()),n.current.dispatch(Y(r))),(0,L.useEffect)(()=>{let e=[function(e){let a=[e({actionCreator:er,effect:async(e,a)=>{a.dispatch(_())}})];return()=>{a.forEach(e=>e())}}(ed),function(e){let a=[e({actionCreator:K,effect:async(e,a)=>{let{payload:r}=e;a.dispatch(Q(r))}})];return()=>{a.forEach(e=>e())}}(ed),function(e){let a=[e({actionCreator:Y,effect:async(e,a)=>{a.dispatch(_())}})];return()=>{a.forEach(e=>e())}}(ed)];return()=>e.forEach(e=>e())},[]),(0,t.jsx)(f.zt,{store:n.current,children:a})}var eh=r(4587);let ep=()=>{let{ownershipFilter:e}=g(e=>e.view),a=v();return(0,t.jsxs)(eh.Ph,{value:e,onValueChange:e=>a(el(e)),children:[(0,t.jsx)(eh.i4,{className:"w-[180px]",children:(0,t.jsx)(eh.ki,{placeholder:"所有权"})}),(0,t.jsxs)(eh.Bw,{children:[(0,t.jsx)(eh.Ql,{value:"both",children:"所有权（全部）"}),(0,t.jsx)(eh.Ql,{value:"true",children:"所有权（拥有）"}),(0,t.jsx)(eh.Ql,{value:"false",children:"所有权（未拥有）"})]})]})};function ef(e){let{characters:a=[]}=e;return(0,t.jsx)(eu,{characters:a,children:(0,t.jsxs)("section",{className:"container grid items-center gap-6 pb-8 pt-6 md:py-10",children:[(0,t.jsx)("div",{className:"flex max-w-[980px] flex-col items-start gap-2",children:(0,t.jsx)("h1",{className:"text-3xl font-extrabold leading-tight tracking-tighter md:text-4xl",children:"原神"})}),(0,t.jsxs)(n.mQ,{defaultValue:"image-text",children:[(0,t.jsxs)("nav",{className:"flex gap-4",children:[(0,t.jsxs)(n.dr,{children:[(0,t.jsx)(n.SP,{value:"text",children:"文字"}),(0,t.jsx)(n.SP,{value:"image-text",children:"图文"})]}),(0,t.jsx)(ep,{}),(0,t.jsx)(d,{}),(0,t.jsx)(O,{})]}),(0,t.jsx)(n.nU,{value:"text",children:(0,t.jsx)(W,{showImage:!1})}),(0,t.jsx)(n.nU,{value:"image-text",children:(0,t.jsx)(W,{showImage:!0})})]})]})})}}},function(e){e.O(0,[415,609,321,610,943,966,744],function(){return e(e.s=51)}),_N_E=e.O()}]);